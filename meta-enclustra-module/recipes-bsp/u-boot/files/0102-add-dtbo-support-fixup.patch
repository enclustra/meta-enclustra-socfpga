From 17446e6849cc637406b11784a548933228c8a7c8 Mon Sep 17 00:00:00 2001
From: Lothar Rubusch <lothar.rubusch@enclustra.com>
Date: Thu, 25 Jan 2024 18:59:20 +0000
Subject: [PATCH] uboot: fix DT overlays

Signed-off-by: Lothar Rubusch <lothar.rubusch@enclustra.com>
---
 board/enclustra/bootscripts/qspi-aa1.cmd | 2 +-
 board/enclustra/bootscripts/qspi.cmd     | 2 +-
 board/enclustra/bootscripts/sd-aa1.cmd   | 9 +++------
 board/enclustra/bootscripts/sd.cmd       | 2 +-
 include/configs/socfpga_mercury_aa1.h    | 3 +++
 5 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/board/enclustra/bootscripts/qspi-aa1.cmd b/board/enclustra/bootscripts/qspi-aa1.cmd
index c89ff13e21..09727bae42 100644
--- a/board/enclustra/bootscripts/qspi-aa1.cmd
+++ b/board/enclustra/bootscripts/qspi-aa1.cmd
@@ -3,5 +3,5 @@ sf probe
 sf read ${ram_addr_kernel} ${qspi_offset_addr_kernel} ${size_kernel}
 sf read ${ram_addr_devicetree} ${qspi_offset_addr_devicetree} ${size_devicetree}
 sf read ${ram_addr_rootfs} ${qspi_offset_addr_rootfs} ${size_rootfs}
-run ${fdtload}
+run fdtload
 bootm ${ram_addr_kernel} ${ram_addr_rootfs} ${ram_addr_devicetree} - ${ram_addr_devicetree}
diff --git a/board/enclustra/bootscripts/qspi.cmd b/board/enclustra/bootscripts/qspi.cmd
index e347be96c2..c8602e1d73 100644
--- a/board/enclustra/bootscripts/qspi.cmd
+++ b/board/enclustra/bootscripts/qspi.cmd
@@ -5,5 +5,5 @@ bridge enable
 sf read ${ram_addr_kernel} ${qspi_offset_addr_kernel} ${size_kernel}
 sf read ${ram_addr_devicetree} ${qspi_offset_addr_devicetree} ${size_devicetree}
 sf read ${ram_addr_rootfs} ${qspi_offset_addr_rootfs} ${size_rootfs}
-run ${fdtload}
+run fdtload
 bootm ${ram_addr_kernel} ${ram_addr_rootfs} ${ram_addr_devicetree} - ${ram_addr_devicetree}
diff --git a/board/enclustra/bootscripts/sd-aa1.cmd b/board/enclustra/bootscripts/sd-aa1.cmd
index b671a5b462..8482af452d 100644
--- a/board/enclustra/bootscripts/sd-aa1.cmd
+++ b/board/enclustra/bootscripts/sd-aa1.cmd
@@ -1,9 +1,6 @@
 bridge enable
 fatload mmc 0:1 ${ram_addr_kernel} uImage
 fatload mmc 0:1 ${ram_addr_devicetree} devicetree.dtb
-fatload mmc 0:1 ${ram_addr_rootfs} uramdisk
-
-altera_set_storage QSPI
-
-run ${fdtload}
-bootm ${ram_addr_kernel} ${ram_addr_rootfs} ${ram_addr_devicetree} - ${ram_addr_devicetree}
+altera_set_storage MMC
+run fdtload
+bootm ${ram_addr_kernel} - ${ram_addr_devicetree}
diff --git a/board/enclustra/bootscripts/sd.cmd b/board/enclustra/bootscripts/sd.cmd
index 0aebe1a6a7..946a1587bc 100644
--- a/board/enclustra/bootscripts/sd.cmd
+++ b/board/enclustra/bootscripts/sd.cmd
@@ -3,5 +3,5 @@ fpga load 0 ${ram_addr_bitstream} 0x${filesize}
 bridge enable
 fatload mmc 0:1 ${ram_addr_kernel} uImage
 fatload mmc 0:1 ${ram_addr_devicetree} devicetree.dtb
-run ${fdtload}
+run fdtload
 bootm ${ram_addr_kernel} - ${ram_addr_devicetree}
diff --git a/include/configs/socfpga_mercury_aa1.h b/include/configs/socfpga_mercury_aa1.h
index 10ef3fd855..997d0929e2 100644
--- a/include/configs/socfpga_mercury_aa1.h
+++ b/include/configs/socfpga_mercury_aa1.h
@@ -25,6 +25,9 @@
 
 /* U-Boot environment */
 #define SOCFPGA_BOOT_SETTINGS \
+    "devtype=mmc\0" \
+    "distro_bootpart=0\\\:1\0" \
+    "fdtfile=devicetree.dtb\0" \
     "qspi_offset_addr_spl=0x0\0" \
     "qspi_offset_addr_u-boot=0x100000\0" \
     "qspi_offset_addr_u-boot-env=0x180000\0" \
-- 
2.34.1

